<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lavander칤a PRO - Sistema de Gesti칩n & Academia</title>
    <!-- Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (Iconos) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f1f5f9; color: #334155; }
        
        /* Animaciones y Transiciones */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Estilos Tarjetas Educativas */
        .concept-card { 
            background: white; 
            border-radius: 12px; 
            border: 1px solid #e2e8f0; 
            padding: 1.5rem; 
            margin-bottom: 1.5rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .concept-card:hover { transform: translateY(-2px); }
        
        .concept-title { font-weight: 700; color: #1e3a8a; display: flex; align-items: center; margin-bottom: 1rem; font-size: 1.1rem; }
        .concept-icon { width: 40px; height: 40px; background: #eff6ff; color: #2563eb; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 1.2rem; }
        
        /* Cajas de Alerta y Pasos */
        .highlight-box { background-color: #f0f9ff; border-left: 5px solid #0ea5e9; padding: 1.2rem; margin: 1rem 0; font-size: 0.95rem; border-radius: 0 8px 8px 0; }
        .danger-box { background-color: #fef2f2; border-left: 5px solid #ef4444; padding: 1.2rem; margin: 1rem 0; font-size: 0.95rem; color: #991b1b; border-radius: 0 8px 8px 0; }
        .step-box { background-color: #f0fdf4; border: 1px solid #bbf7d0; padding: 1rem; margin-top: 0.8rem; border-radius: 8px; position: relative; padding-left: 3.5rem; }
        .step-number { position: absolute; left: 1rem; top: 1rem; width: 2rem; height: 2rem; background: #22c55e; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* Tablas */
        .tech-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; font-size: 0.9rem; overflow: hidden; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tech-table th { background: #1e293b; color: white; padding: 14px; text-align: left; }
        .tech-table td { border-bottom: 1px solid #e2e8f0; padding: 12px; background: white; }
        .tech-table tr:last-child td { border-bottom: none; }
        .tech-table tr:nth-child(even) td { background: #f8fafc; }
        
        /* Escala pH */
        .ph-gradient { height: 24px; width: 100%; border-radius: 12px; background: linear-gradient(90deg, #ef4444 0%, #eab308 50%, #3b82f6 100%); margin-bottom: 0.5rem; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Navegaci칩n Superior Fija -->
    <nav class="bg-slate-900 text-white shadow-xl flex-none z-50">
        <div class="max-w-7xl mx-auto px-4 w-full">
            <div class="flex justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="bg-blue-600 p-2 rounded-lg mr-3 shadow-lg shadow-blue-500/30">
                        <i class="fa-solid fa-shirt text-xl text-white"></i>
                    </div>
                    <div>
                        <span class="font-bold text-xl block leading-none tracking-tight">Lavander칤a PRO</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-widest font-semibold">Gesti칩n & Escuela</span>
                    </div>
                </div>
                <!-- Botones Men칰 -->
                <div class="flex space-x-2 items-center">
                    <button onclick="switchTab('machine')" class="tab-btn px-4 py-2 hover:bg-slate-800 rounded-lg transition text-sm flex items-center font-medium bg-slate-800 text-blue-300 border border-slate-700 shadow-sm" id="btn-machine">
                        <i class="fa-solid fa-calculator mr-2"></i>Herramientas
                    </button>
                    <button onclick="switchTab('learning')" class="tab-btn px-4 py-2 hover:bg-slate-800 rounded-lg transition text-sm flex items-center font-medium text-slate-300 border border-transparent" id="btn-learning">
                        <i class="fa-solid fa-graduation-cap mr-2"></i>Academia
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 츼rea de Contenido Principal -->
    <div class="flex-grow overflow-y-auto bg-slate-100 p-4 scroll-smooth">
        <div class="max-w-6xl mx-auto">

            <!-- ========================================== -->
            <!-- PESTA칌A 1: GESTOR (CALCULADORA) -->
            <!-- ========================================== -->
            <div id="machine" class="tab-content active fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    <!-- Columna Izq: Configuraci칩n (4 columnas) -->
                    <div class="lg:col-span-4 space-y-6">
                        <!-- Tarjeta Configuraci칩n -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center border-b pb-3">
                                <i class="fa-solid fa-sliders mr-2 text-blue-600 bg-blue-50 p-2 rounded"></i> 
                                Datos de la M치quina
                            </h2>
                            <div class="space-y-5">
                                <div>
                                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wide">Capacidad Total (kg)</label>
                                    <div class="relative mt-1">
                                        <input type="number" id="machineCapacity" class="w-full pl-3 pr-10 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition" placeholder="20" value="20" oninput="updateAllCalculations()">
                                        <span class="absolute right-3 top-2 text-slate-400 text-sm">kg</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wide">Factor de Carga</label>
                                    <select id="loadFactor" class="w-full p-2 border border-slate-300 rounded-lg mt-1 text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none" onchange="updateAllCalculations()">
                                        <option value="1.0">100% - Ropa Plana (S치banas)</option>
                                        <option value="0.8">80% - Ropa Forma / Toallas</option>
                                        <option value="0.5">50% - Delicados / Edredones</option>
                                    </select>
                                </div>
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg text-center border border-blue-100">
                                    <p class="text-xs text-blue-600 font-bold uppercase mb-1">Carga Real Recomendada</p>
                                    <p class="text-3xl font-bold text-blue-900"><span id="realLoadDisplay">0</span> <span class="text-lg text-blue-400">kg</span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Tarjeta Resumen Totales -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 border-t-4 border-t-purple-500">
                            <p class="text-xs text-slate-400 font-bold uppercase text-center mb-4">TOTALES A PONER EN LA M츼QUINA</p>
                            <div class="space-y-3 font-mono text-sm">
                                <div class="flex justify-between items-center py-2 border-b border-dashed">
                                    <span class="text-slate-600">Alcalino:</span> 
                                    <span id="totalAlkaline" class="font-bold text-lg text-slate-800 bg-slate-100 px-2 rounded">0 ml</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-dashed">
                                    <span class="text-slate-600">Detergente:</span> 
                                    <span id="totalDetergent" class="font-bold text-lg text-slate-800 bg-slate-100 px-2 rounded">0 ml</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-dashed">
                                    <span class="text-slate-600">Blanqueador:</span> 
                                    <span id="totalBleach" class="font-bold text-lg text-slate-800 bg-slate-100 px-2 rounded">0 ml</span>
                                </div>
                                <div class="flex justify-between items-center pt-2">
                                    <span class="text-purple-700 font-bold">Neutralizante:</span> 
                                    <span id="totalNeutralizer" class="font-bold text-lg text-purple-700 bg-purple-50 px-2 rounded border border-purple-100">0 ml</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Columna Der: Recepci칩n y Detalles (8 columnas) -->
                    <div class="lg:col-span-8 space-y-6">
                        
                        <!-- Panel Recepci칩n -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <div class="flex justify-between items-center mb-6 border-b pb-3">
                                <h2 class="text-lg font-bold text-slate-800 flex items-center">
                                    <i class="fa-solid fa-basket-shopping mr-2 text-green-600 bg-green-50 p-2 rounded"></i>
                                    Recepci칩n de Ropa
                                </h2>
                                <span class="text-xs font-bold bg-slate-100 text-slate-600 px-3 py-1 rounded-full border">
                                    Total: <span id="totalIncomingWeight" class="text-slate-900 text-sm">0</span> kg
                                </span>
                            </div>
                            
                            <!-- Inputs Recepci칩n -->
                            <div class="flex flex-col md:flex-row gap-3 mb-6 bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <div class="flex-grow">
                                    <label class="text-xs font-bold text-slate-400 block mb-1">Tipo de Prenda</label>
                                    <input type="text" id="garmentType" placeholder="Ej: S치banas cama 302" class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div class="w-full md:w-32">
                                    <label class="text-xs font-bold text-slate-400 block mb-1">Peso (kg)</label>
                                    <input type="number" id="garmentWeight" placeholder="0.0" class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div class="w-full md:w-48">
                                    <label class="text-xs font-bold text-slate-400 block mb-1">Suciedad</label>
                                    <select id="soilLevel" class="w-full p-2 border rounded text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                                        <option value="ligera">Ligera (Normal)</option>
                                        <option value="pesada">Pesada (Grasa/Tierra)</option>
                                        <option value="biologica">驕勇 Biol칩gica (Sangre)</option>
                                    </select>
                                </div>
                                <div class="flex items-end">
                                    <button onclick="addGarment()" class="w-full md:w-auto bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-bold shadow-sm shadow-green-200 active:scale-95">
                                        <i class="fa-solid fa-plus mr-1"></i> A침adir
                                    </button>
                                </div>
                            </div>

                            <!-- Lista -->
                            <div class="rounded-lg border border-slate-200 overflow-hidden mb-4">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50 text-slate-500 font-bold text-xs uppercase">
                                        <tr>
                                            <th class="px-4 py-3">Prenda</th>
                                            <th class="px-4 py-3">Peso</th>
                                            <th class="px-4 py-3">Tipo Suciedad</th>
                                            <th class="px-4 py-3 text-right">Acci칩n</th>
                                        </tr>
                                    </thead>
                                    <tbody id="garmentList" class="divide-y divide-slate-100 bg-white">
                                        <tr>
                                            <td colspan="4" class="px-4 py-8 text-center text-slate-400 italic">No hay prendas a침adidas. La calculadora usar치 la capacidad de la m치quina por defecto.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Alerta Protocolo Din치mica -->
                            <div id="protocolAlert" class="hidden animate-pulse"></div>
                        </div>

                        <!-- Panel Dosis Qu칤mica (Inputs) -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-lg font-bold text-slate-800 flex items-center">
                                    <i class="fa-solid fa-flask mr-2 text-purple-600 bg-purple-50 p-2 rounded"></i>
                                    Configurar Productos (ml/kg)
                                </h2>
                                <button onclick="switchToHelp()" class="text-xs text-blue-600 hover:text-blue-800 font-semibold hover:underline bg-blue-50 px-3 py-1 rounded-full transition">
                                    <i class="fa-solid fa-circle-question mr-1"></i> 쯅o tienes el dato ml/kg?
                                </button>
                            </div>

                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="group">
                                    <label class="text-xs font-bold text-slate-500 mb-1 block group-hover:text-blue-600 transition">Alcalino</label>
                                    <input type="number" id="doseAlkaline" class="w-full p-2 border border-slate-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-center font-semibold text-slate-700" placeholder="3" oninput="calcChem()">
                                </div>
                                <div class="group">
                                    <label class="text-xs font-bold text-slate-500 mb-1 block group-hover:text-blue-600 transition">Detergente</label>
                                    <input type="number" id="doseDetergent" class="w-full p-2 border border-slate-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-center font-semibold text-slate-700" placeholder="2" oninput="calcChem()">
                                </div>
                                <div class="group">
                                    <label class="text-xs font-bold text-slate-500 mb-1 block group-hover:text-blue-600 transition">Blanqueador</label>
                                    <input type="number" id="doseBleach" class="w-full p-2 border border-slate-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-center font-semibold text-slate-700" placeholder="5" oninput="calcChem()">
                                </div>
                                <div class="group">
                                    <label class="text-xs font-bold text-purple-600 mb-1 block">Neutralizante</label>
                                    <input type="number" id="doseNeutralizer" class="w-full p-2 border border-purple-200 bg-purple-50 rounded focus:border-purple-500 focus:ring-1 focus:ring-purple-500 text-center font-semibold text-purple-800" placeholder="1" oninput="calcChem()">
                                </div>
                            </div>
                            <p class="text-xs text-slate-400 mt-3 text-center italic">Ingresa la dosis recomendada por tu proveedor qu칤mico. Si no la sabes, consulta la Academia (Cap칤tulo 7).</p>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- PESTA칌A 2: ACADEMIA (MASTER CLASS) -->
            <!-- ========================================== -->
            <div id="learning" class="tab-content fade-in pb-12">
                
                <div class="max-w-4xl mx-auto">
                    <!-- Men칰 Desplegable de Cap칤tulos -->
                    <div class="bg-white p-4 rounded-xl shadow-lg mb-6 sticky top-2 z-40 border-l-4 border-blue-600 ring-1 ring-black/5">
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2 ml-1">游닄 Selecciona el M칩dulo de Estudio:</label>
                        <div class="relative">
                            <select id="chapterSelect" onchange="loadChapter(this.value)" class="w-full p-4 pl-12 border border-slate-200 rounded-lg text-slate-800 font-bold text-lg focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50 appearance-none cursor-pointer hover:bg-white transition shadow-inner">
                                <option value="0">0. Introducci칩n: 쯃avar o Limpiar?</option>
                                <option value="1">1. Las Fibras: Algod칩n vs Poli칠ster</option>
                                <option value="2">2. El Paso a Paso: Manual (Alberca) vs M치quina</option>
                                <option value="3">3. El C칤rculo de Sinner (Teor칤a Fundamental)</option>
                                <option value="4">4. Qu칤mica 1: pH y Alcalinidad</option>
                                <option value="5">5. Qu칤mica 2: Blanqueo y Neutralizado</option>
                                <option value="6">6. Protocolos de Desmanchado (Sangre, Grasa...)</option>
                                <option value="7">7. Errores Cr칤ticos y C치lculo de Dosis</option>
                            </select>
                            <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-600 text-xl pointer-events-none">
                                <i class="fa-solid fa-book-open-reader"></i>
                            </div>
                            <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Contenedor del Contenido -->
                    <div id="course-content" class="bg-white rounded-xl shadow-xl p-8 md:p-12 min-h-[600px] border border-slate-100">
                        <!-- El contenido se inyecta aqu칤 -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- JAVASCRIPT: L칩gica de la Aplicaci칩n -->
    <script>
        // --- NAVEGACI칍N ---
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // Actualizar botones men칰
            const btnMachine = document.getElementById('btn-machine');
            const btnLearning = document.getElementById('btn-learning');
            
            if(id === 'machine') {
                btnMachine.className = "tab-btn px-4 py-2 bg-slate-800 text-blue-300 rounded-lg text-sm flex items-center font-medium border border-slate-700 shadow-sm";
                btnLearning.className = "tab-btn px-4 py-2 hover:bg-slate-800 rounded-lg text-sm flex items-center font-medium text-slate-300 border border-transparent";
                updateAllCalculations(); // Recalcular al volver
            } else {
                btnMachine.className = "tab-btn px-4 py-2 hover:bg-slate-800 rounded-lg text-sm flex items-center font-medium text-slate-300 border border-transparent";
                btnLearning.className = "tab-btn px-4 py-2 bg-slate-800 text-blue-300 rounded-lg text-sm flex items-center font-medium border border-slate-700 shadow-sm";
            }
        }

        function switchToHelp() {
            switchTab('learning');
            const select = document.getElementById('chapterSelect');
            select.value = "7";
            loadChapter(7);
        }

        // --- GESTI칍N DE ROPA ---
        let garments = [];

        function addGarment() {
            const typeInput = document.getElementById('garmentType');
            const weightInput = document.getElementById('garmentWeight');
            const soilInput = document.getElementById('soilLevel');
            
            const type = typeInput.value.trim();
            const w = parseFloat(weightInput.value);
            const soil = soilInput.value;

            if(!type || !w || w <= 0) {
                alert("Por favor ingrese un tipo de prenda y un peso v치lido.");
                return;
            }

            garments.push({type, w, soil});
            renderGarments();
            
            // Limpiar inputs
            typeInput.value = "";
            weightInput.value = "";
            typeInput.focus();
        }

        function removeGarment(index) {
            garments.splice(index, 1);
            renderGarments();
        }

        function renderGarments() {
            const list = document.getElementById('garmentList');
            list.innerHTML = "";
            
            let totalWeight = 0;
            let hasBio = false;
            let hasHeavy = false;

            if (garments.length === 0) {
                list.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-slate-400 italic">No hay prendas a침adidas. La calculadora usar치 la capacidad de la m치quina por defecto.</td></tr>';
            } else {
                garments.forEach((g, i) => {
                    totalWeight += g.w;
                    
                    let badgeClass = "bg-slate-100 text-slate-600";
                    let icon = "";
                    
                    if(g.soil === 'biologica') {
                        hasBio = true;
                        badgeClass = "bg-red-100 text-red-700 font-bold border border-red-200";
                        icon = "驕勇 ";
                    } else if (g.soil === 'pesada') {
                        hasHeavy = true;
                        badgeClass = "bg-orange-100 text-orange-700 font-bold border border-orange-200";
                        icon = "游댢 ";
                    } else {
                        badgeClass = "bg-green-50 text-green-700 border border-green-100";
                    }

                    list.innerHTML += `
                        <tr class="hover:bg-slate-50 transition">
                            <td class="px-4 py-3 font-medium text-slate-700">${g.type}</td>
                            <td class="px-4 py-3 text-slate-600">${g.w} kg</td>
                            <td class="px-4 py-3">
                                <span class="text-xs px-2 py-1 rounded-full ${badgeClass}">
                                    ${icon}${g.soil.toUpperCase()}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-right">
                                <button onclick="removeGarment(${i})" class="text-slate-400 hover:text-red-500 transition px-2">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }

            // Actualizar total visual
            document.getElementById('totalIncomingWeight').innerText = totalWeight.toFixed(1);

            // Alerta de Protocolo
            const alertBox = document.getElementById('protocolAlert');
            if(hasBio) {
                alertBox.className = "block bg-red-50 border-l-4 border-red-500 text-red-900 p-4 rounded-r mt-4 shadow-sm animate-pulse";
                alertBox.innerHTML = `
                    <div class="flex items-start">
                        <i class="fa-solid fa-triangle-exclamation text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="block font-bold">丘멆잺 ALERTA DE RIESGO BIOL칍GICO DETECTADA</strong>
                            <ul class="list-disc list-inside text-sm mt-1 space-y-1">
                                <li><strong>EPP:</strong> Use guantes gruesos y mascarilla.</li>
                                <li><strong>Prohibido:</strong> NO use agua caliente al inicio (Fija la sangre).</li>
                                <li><strong>Protocolo:</strong> Prelavado AGUA FR칈A + Lavado T칠rmico >70춿C.</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else if (hasHeavy) {
                alertBox.className = "block bg-orange-50 border-l-4 border-orange-500 text-orange-900 p-4 rounded-r mt-4 shadow-sm";
                alertBox.innerHTML = `
                    <div class="flex items-start">
                        <i class="fa-solid fa-oil-can text-xl mr-3 mt-1"></i>
                        <div>
                            <strong class="block font-bold">SUCIEDAD PESADA / GRASA</strong>
                            <p class="text-sm mt-1">Se requiere temperatura alta (>65춿C) y dosis extra de detergente alcalino para emulsionar la grasa.</p>
                        </div>
                    </div>
                `;
            } else {
                alertBox.className = "hidden";
            }

            // Actualizar c치lculos globales
            updateAllCalculations();
        }

        // --- C츼LCULOS ---
        function updateAllCalculations() {
            // 1. Capacidad M치quina
            const cap = parseFloat(document.getElementById('machineCapacity').value) || 0;
            const factor = parseFloat(document.getElementById('loadFactor').value) || 1;
            const realLoad = (cap * factor).toFixed(1);
            
            document.getElementById('realLoadDisplay').innerText = realLoad;

            // 2. Determinar base de c치lculo (Lista o Capacidad M치quina)
            const listWeight = parseFloat(document.getElementById('totalIncomingWeight').innerText) || 0;
            const calculationBase = listWeight > 0 ? listWeight : realLoad;
            
            // 3. Qu칤mica
            calcChem(calculationBase);
        }

        function calcChem(baseWeight = null) {
            // Si llamamos directamente desde el input, buscamos el peso base
            if(baseWeight === null || typeof baseWeight !== 'number') {
                const listW = parseFloat(document.getElementById('totalIncomingWeight').innerText) || 0;
                const machW = parseFloat(document.getElementById('realLoadDisplay').innerText) || 0;
                baseWeight = listW > 0 ? listW : machW;
            }

            const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
            
            document.getElementById('totalAlkaline').innerText = Math.round(getVal('doseAlkaline') * baseWeight) + ' ml';
            document.getElementById('totalDetergent').innerText = Math.round(getVal('doseDetergent') * baseWeight) + ' ml';
            document.getElementById('totalBleach').innerText = Math.round(getVal('doseBleach') * baseWeight) + ' ml';
            document.getElementById('totalNeutralizer').innerText = Math.round(getVal('doseNeutralizer') * baseWeight) + ' ml';
        }

        // --- CONTENIDO ACADEMIA ---
        const courseData = [
            {
                title: "0. Introducci칩n: 쯃avar o Limpiar?",
                content: `
                    <p class="text-lg text-slate-600 mb-6 leading-relaxed">Lavar ropa en casa es intuici칩n y "oj칤metro". Lavar ropa industrialmente es <strong>Ciencia Pura</strong>. En este curso aprender치s a controlar las variables qu칤micas y f칤sicas para garantizar higiene, blancura y rentabilidad.</p>
                    
                    <div class="concept-card">
                        <div class="concept-title"><div class="concept-icon"><i class="fa-solid fa-water"></i></div>El Agua: Tu Materia Prima</div>
                        <p class="text-slate-600">El agua no es solo H2O. El agua tiene "personalidad" y se llama <strong>Dureza</strong>.</p>
                        <ul class="list-disc list-inside mt-3 text-sm text-slate-600 space-y-2">
                            <li><strong>Agua Dura:</strong> Tiene mucho Calcio y Magnesio. Estos minerales "matan" el jab칩n. Si tu agua es dura, gastar치s el doble de detergente para obtener la misma espuma.</li>
                            <li><strong>Agua Blanda:</strong> Ideal para lavar. El detergente rinde al 100%.</li>
                        </ul>
                        <div class="highlight-box">
                            游눠 <strong>Tip Pro:</strong> Si la ropa sale gris치cea, 치spera (como lija) y las toallas no secan bien, probablemente tienes problemas de dureza del agua o falta de neutralizante.
                        </div>
                    </div>
                `
            },
            {
                title: "1. Identificaci칩n de Fibras",
                content: `
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">Conoce a tu enemigo (o amigo)</h3>
                    <p class="mb-6 text-slate-600">No puedes tratar igual a una s치bana de algod칩n que a un mantel de poli칠ster. Son opuestos qu칤micos.</p>

                    <table class="tech-table">
                        <thead>
                            <tr>
                                <th>Caracter칤stica</th>
                                <th>Algod칩n (Natural) 游</th>
                                <th>Poli칠ster (Sint칠tico) 游빍</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="font-bold text-slate-700">Comportamiento con Agua</td>
                                <td>La ama (Hidrof칤lico). Absorbe mucho agua.</td>
                                <td>La odia (Hidrof칩bico). Se seca muy r치pido.</td>
                            </tr>
                            <tr>
                                <td class="font-bold text-slate-700">Comportamiento con Grasa</td>
                                <td>F치cil de quitar.</td>
                                <td><strong>Im치n de grasa</strong> (Oleof칤lico). La absorbe y no la suelta.</td>
                            </tr>
                            <tr>
                                <td class="font-bold text-slate-700">Resistencia T칠rmica</td>
                                <td>Resiste altas temperaturas (90춿C).</td>
                                <td>Sensible al <strong>Choque T칠rmico</strong>. Se arruga permanentemente si se enfr칤a r치pido.</td>
                            </tr>
                             <tr>
                                <td class="font-bold text-slate-700">Qu칤mica</td>
                                <td>Resiste Cloro (si es blanco).</td>
                                <td>El Cloro puede amarillearlo con el tiempo.</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="danger-box">
                        <i class="fa-solid fa-triangle-exclamation mr-2"></i> <strong>El Fen칩meno de la Redeposici칩n:</strong><br>
                        El poli칠ster tiene carga el칠ctrica est치tica. Si el agua de lavado est치 sucia y no hay suficiente detergente, la mugre que solt칩 vuelve a pegarse al poli칠ster como un im치n, dej치ndolo gris para siempre.
                    </div>
                `
            },
            {
                title: "2. Paso a Paso: Alberca vs M치quina",
                content: `
                    <p class="text-lg text-slate-600 mb-6">Existen dos formas de iniciar el proceso: en la <strong>Alberca (Manual)</strong> o directo en la <strong>M치quina (Autom치tico)</strong>. Elegir mal puede costarte dinero o fijar manchas.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- M칄TODO 1: ALBERCA -->
                        <div class="concept-card !mb-0 border-l-4 border-l-blue-500 bg-blue-50/50">
                            <div class="concept-title text-blue-800"><i class="fa-solid fa-hand-holding-droplet mr-2"></i> M칄TODO 1: Lavado en Alberca</div>
                            <p class="text-sm mb-4 text-slate-600">Ideal para: Ropa extremadamente sucia (barro, grasa mec치nica), traperos, o remojo largo.</p>
                            
                            <div class="step-box">
                                <div class="step-number">1</div>
                                <strong>Llenado y Qu칤mica</strong><br>
                                Disuelve el detergente alcalino ANTES de meter la ropa. <br><span class="text-red-600 font-bold text-xs">춰Si hay sangre usa AGUA FR칈A!</span>
                            </div>
                            <div class="step-box">
                                <div class="step-number">2</div>
                                <strong>Inmersi칩n (Remojo)</strong><br>
                                Grasa: 2 horas agua caliente.<br>Sangre: 1 hora agua fr칤a.
                            </div>
                            <div class="step-box">
                                <div class="step-number">3</div>
                                <strong>Frotado Manual</strong><br>
                                Usa cepillo en zonas dif칤ciles. La m치quina no ve manchas, t칰 s칤.
                            </div>
                        </div>

                        <!-- M칄TODO 2: M츼QUINA -->
                        <div class="concept-card !mb-0 border-l-4 border-l-green-500 bg-green-50/50">
                            <div class="concept-title text-green-800"><i class="fa-solid fa-robot mr-2"></i> M칄TODO 2: Directo en M치quina</div>
                            <p class="text-sm mb-4 text-slate-600">Ideal para: S치banas de hotel, Riesgo Biol칩gico (seguridad) y Rapidez.</p>
                            
                            <div class="step-box">
                                <div class="step-number">1</div>
                                <strong>Carga Correcta</strong><br>
                                Deja un pu침o de aire arriba. Si llenas a tope, la ropa no cae y no se lava.
                            </div>
                            <div class="step-box">
                                <div class="step-number">2</div>
                                <strong>El "Flush" (Prelavado)</strong><br>
                                3 min con agua fr칤a y nivel ALTO. Solo para sacar polvo y orina.
                            </div>
                            <div class="step-box">
                                <div class="step-number">3</div>
                                <strong>Lavado Principal</strong><br>
                                Nivel BAJO (para que la ropa golpee al caer), agua caliente y todos los qu칤micos.
                            </div>
                        </div>
                    </div>
                `
            },
            {
                title: "3. El C칤rculo de Sinner (Teor칤a Vital)",
                content: `
                    <div class="flex items-center mb-8 bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                        <div class="text-5xl text-blue-600 mr-6"><i class="fa-solid fa-chart-pie"></i></div>
                        <div>
                            <h3 class="font-bold text-xl mb-1 text-slate-800">La F칩rmula de la Limpieza</h3>
                            <p class="text-slate-600">Herbert Sinner descubri칩 que para limpiar CUALQUIER COSA se necesitan 4 factores. Si quitas uno, tienes que aumentar los otros.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="concept-card !mb-0 border-t-4 border-t-blue-500">
                            <h4 class="font-bold text-blue-800 text-lg mb-2"><i class="fa-solid fa-flask mr-2"></i> 1. Qu칤mica</h4>
                            <p class="text-sm text-slate-600">El detergente. Es el agente que rompe los enlaces de la suciedad.</p>
                        </div>
                        <div class="concept-card !mb-0 border-t-4 border-t-red-500">
                            <h4 class="font-bold text-red-800 text-lg mb-2"><i class="fa-solid fa-temperature-full mr-2"></i> 2. Temperatura</h4>
                            <p class="text-sm text-slate-600">El calor acelera las reacciones y derrite las grasas s칩lidas.</p>
                        </div>
                        <div class="concept-card !mb-0 border-t-4 border-t-green-500">
                            <h4 class="font-bold text-green-800 text-lg mb-2"><i class="fa-solid fa-arrows-rotate mr-2"></i> 3. Mec치nica</h4>
                            <p class="text-sm text-slate-600">El movimiento. El golpe de la ropa al caer dentro del tambor.</p>
                        </div>
                        <div class="concept-card !mb-0 border-t-4 border-t-yellow-500">
                            <h4 class="font-bold text-yellow-800 text-lg mb-2"><i class="fa-solid fa-clock mr-2"></i> 4. Tiempo</h4>
                            <p class="text-sm text-slate-600">La qu칤mica no es m치gica, necesita minutos para actuar.</p>
                        </div>
                    </div>

                    <div class="highlight-box mt-6">
                        <strong>Ejemplo Pr치ctico de Sinner:</strong><br>
                        Si lavas con <strong>Agua Fr칤a</strong> (reduces Temperatura), obligatoriamente debes aumentar la <strong>Qu칤mica</strong> (usar m치s jab칩n) o aumentar el <strong>Tiempo</strong> de lavado. Si no compensas, la ropa queda sucia.
                    </div>
                `
            },
            {
                title: "4. Qu칤mica 1: El pH y la Alcalinidad",
                content: `
                    <h3 class="text-xl font-bold text-slate-800 mb-4">La Guerra del pH</h3>
                    <p class="mb-4 text-slate-600">El lavado es un viaje. Subimos el pH para atacar la suciedad, y debemos bajarlo para cuidar la piel.</p>
                    
                    <div class="bg-slate-800 p-4 rounded-xl text-white mb-6">
                        <div class="ph-gradient"></div>
                        <div class="flex justify-between text-xs font-bold mt-2">
                            <span class="text-red-400">0 (츼CIDO)</span>
                            <span class="text-yellow-400">7 (NEUTRO)</span>
                            <span class="text-blue-400">14 (ALCALINO)</span>
                        </div>
                        <div class="flex justify-between text-xs mt-1 opacity-70">
                            <span>Neutralizante</span>
                            <span>Agua Pura</span>
                            <span>Cloro / Desengrasante</span>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="concept-card border-l-4 border-l-blue-600">
                            <div class="concept-title text-blue-800">Detergente Alcalino (pH 10-12)</div>
                            <p class="text-slate-700"><strong>쯈u칠 hace?</strong> "Hincha" la fibra de algod칩n para abrirla (como abrir una pi침a) y que suelte la suciedad. Adem치s, convierte las grasas en jab칩n (Saponificaci칩n).</p>
                            <p class="text-sm mt-2 text-slate-500 italic">Es el "martillo" del lavado. Necesario, pero agresivo.</p>
                        </div>
                        <div class="concept-card border-l-4 border-l-indigo-600">
                            <div class="concept-title text-indigo-800">Tensoactivos (El Jab칩n)</div>
                            <p class="text-slate-700"><strong>쯈u칠 hace?</strong> El agua tiene "tensi칩n superficial" (por eso forma gotas). El tensoactivo rompe esa tensi칩n para que el agua moje de verdad y penetre el tejido.</p>
                        </div>
                    </div>
                `
            },
            {
                title: "5. Qu칤mica 2: Blanqueo y Neutralizado",
                content: `
                    <h3 class="text-xl font-bold text-slate-800 mb-6">El Acabado Final</h3>
                    
                    <h4 class="font-bold text-slate-700 mb-2 border-b pb-2">1. Oxidantes (Blanqueadores)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white p-4 rounded border shadow-sm">
                            <h5 class="font-bold text-blue-600">Cloro (Hipoclorito)</h5>
                            <ul class="text-sm text-slate-600 mt-2 list-disc list-inside">
                                <li>Solo algod칩n blanco.</li>
                                <li>Funciona en fr칤o.</li>
                                <li>Da침a la tela r치pido.</li>
                                <li><span class="text-red-500 font-bold">춰Peligro con Clorhexidina!</span></li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border shadow-sm">
                            <h5 class="font-bold text-green-600">Ox칤geno (Per칩xido)</h5>
                            <ul class="text-sm text-slate-600 mt-2 list-disc list-inside">
                                <li>Seguro para color.</li>
                                <li>Requiere calor (>60춿C).</li>
                                <li>M치s suave con la fibra.</li>
                                <li>Ecol칩gico.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="concept-card border-l-4 border-l-purple-500 bg-purple-50/30">
                        <div class="concept-title text-purple-800">El Neutralizante (Sour)</div>
                        <p class="text-slate-700">Despu칠s de lavar con Alcalinos (pH 11) y Cloro, la ropa queda irritante.</p>
                        <p class="mt-2 font-bold text-purple-900">쯇or qu칠 es obligatorio?</p>
                        <ul class="list-disc list-inside mt-2 text-sm text-slate-700 space-y-1">
                            <li>Baja el pH a 5.5 (igual que la piel humana) para evitar alergias.</li>
                            <li>Evita que la ropa se ponga <strong>amarilla</strong> al plancharla.</li>
                            <li>Elimina el color gris치ceo causado por el agua dura.</li>
                        </ul>
                    </div>
                `
            },
            {
                title: "6. Protocolos de Desmanchado",
                content: `
                    <div class="space-y-4">
                        <!-- Sangre -->
                        <details class="bg-white border border-red-100 rounded-lg p-4 group open:shadow-md transition">
                            <summary class="font-bold text-red-700 cursor-pointer flex justify-between items-center text-lg">
                                <span>游뽖 Sangre y Prote칤nas (Biol칩gico)</span>
                                <i class="fa-solid fa-chevron-down transition group-open:rotate-180 text-red-300"></i>
                            </summary>
                            <div class="pt-4 text-sm text-slate-700">
                                <p class="mb-2"><strong>Regla de Oro:</strong> <span class="bg-red-100 text-red-800 px-2 py-1 rounded font-bold">AGUA FR칈A PRIMERO</span></p>
                                <p>El calor coagula la prote칤na (como fre칤r un huevo). Si metes agua caliente al inicio, la mancha se "cocina" y no sale nunca.</p>
                                <div class="step-box">
                                    <strong class="text-green-700">Receta:</strong><br>
                                    1. Prelavado 5 min Agua FR칈A.<br>
                                    2. Lavado Alcalino 75춿C.<br>
                                    3. Per칩xido de Hidr칩geno.
                                </div>
                            </div>
                        </details>

                        <!-- Grasa -->
                        <details class="bg-white border border-orange-100 rounded-lg p-4 group open:shadow-md transition">
                            <summary class="font-bold text-orange-700 cursor-pointer flex justify-between items-center text-lg">
                                <span>游댢 Grasa Mec치nica / Aceites</span>
                                <i class="fa-solid fa-chevron-down transition group-open:rotate-180 text-orange-300"></i>
                            </summary>
                            <div class="pt-4 text-sm text-slate-700">
                                <p>La grasa es s칩lida a temperatura ambiente. El agua fr칤a rebota.</p>
                                <div class="step-box">
                                    <strong class="text-green-700">Receta:</strong><br>
                                    1. Aplicar desengrasante puro sobre la mancha en seco (15 min antes).<br>
                                    2. Lavar a ALTA TEMPERATURA (>70춿C) para derretirla.<br>
                                    3. Dosis doble de Alcalino para que no se vuelva a pegar.
                                </div>
                            </div>
                        </details>

                        <!-- Clorhexidina -->
                        <details class="bg-white border border-pink-100 rounded-lg p-4 group open:shadow-md transition">
                            <summary class="font-bold text-pink-700 cursor-pointer flex justify-between items-center text-lg">
                                <span>游빖 Clorhexidina (El Desastre Hospitalario)</span>
                                <i class="fa-solid fa-chevron-down transition group-open:rotate-180 text-pink-300"></i>
                            </summary>
                            <div class="pt-4 text-sm text-slate-700">
                                <p>Es el desinfectante de manos rosado de los hospitales. Es invisible en la ropa seca.</p>
                                <p class="mt-2 font-bold text-red-600 bg-red-50 p-2 rounded border border-red-100 text-center">Reacci칩n Qu칤mica: Clorhexidina + Cloro (Lej칤a) = Mancha Marr칩n Indeleble.</p>
                                <p class="mt-2"><strong>Prevenci칩n:</strong> En ropa de quir칩fano, NUNCA usar Cloro. Usar solamente Per칩xido.</p>
                            </div>
                        </details>
                        
                         <!-- Oxido -->
                        <details class="bg-white border border-amber-100 rounded-lg p-4 group open:shadow-md transition">
                            <summary class="font-bold text-amber-700 cursor-pointer flex justify-between items-center text-lg">
                                <span>久勇 칍xido (Metal)</span>
                                <i class="fa-solid fa-chevron-down transition group-open:rotate-180 text-amber-300"></i>
                            </summary>
                            <div class="pt-4 text-sm text-slate-700">
                                <p>El jab칩n no le hace nada al metal. El cloro lo oxida m치s.</p>
                                <div class="step-box">
                                    <strong class="text-green-700">Receta:</strong><br>
                                    Necesitas un 치cido espec칤fico (츼cido Ox치lico o Fluorh칤drico). Aplicar con guantes solo en la mancha y enjuagar r치pido.
                                </div>
                            </div>
                        </details>
                    </div>
                `
            },
            {
                title: "7. Errores Cr칤ticos y C치lculo de Dosis",
                content: `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <!-- Error Choque T칠rmico -->
                        <div class="danger-box !m-0 !rounded-lg shadow-sm">
                            <h4 class="font-bold mb-2 flex items-center"><i class="fa-solid fa-temperature-arrow-down mr-2"></i> 1. El Choque T칠rmico</h4>
                            <p class="text-sm"><strong>El Error:</strong> Lavar poli칠ster a 70춿C y vaciar el agua para meter agua fr칤a de golpe.</p>
                            <p class="text-sm mt-2"><strong>Resultado:</strong> El poli칠ster caliente es pl치stico blando. Al enfriarlo de golpe, se "congela" arrugado. Esas arrugas no salen ni con plancha industrial.</p>
                            <p class="text-sm mt-2 text-green-700 font-bold">九 Soluci칩n: "Cool Down". Enfriar poco a poco.</p>
                        </div>

                        <!-- Error Combusti칩n -->
                        <div class="danger-box !m-0 !rounded-lg border-l-orange-500 bg-orange-50 text-orange-900 shadow-sm">
                            <h4 class="font-bold mb-2 flex items-center"><i class="fa-solid fa-fire mr-2"></i> 2. Combusti칩n Espont치nea</h4>
                            <p class="text-sm"><strong>El Error:</strong> Secar toallas con restos de aceite (spa/cocina) y dejarlas en un carrito calientes sin enfriar.</p>
                            <p class="text-sm mt-2"><strong>Resultado:</strong> El aceite oxidado caliente genera su propio calor y prende fuego solo, horas despu칠s.</p>
                            <p class="text-sm mt-2 text-green-700 font-bold">九 Soluci칩n: Ciclo "Cool Down" obligatorio en secadora.</p>
                        </div>
                        
                        <!-- Calculadora Mental -->
                         <div class="concept-card !m-0 col-span-1 md:col-span-2 !bg-blue-600 !text-white !border-none shadow-lg">
                            <h4 class="font-bold text-xl mb-4 text-center"><i class="fa-solid fa-calculator mr-2"></i> Maestro de la Dosificaci칩n</h4>
                            
                            <div class="bg-white/10 p-4 rounded-lg backdrop-blur-sm mb-4 border border-white/20">
                                <p class="text-sm mb-2 font-bold text-blue-100 text-center uppercase">La F칩rmula de Conversi칩n</p>
                                <p class="text-center text-lg italic">"쯄i detergente dice 'Use 100ml para 10kg', qu칠 pongo en la App?"</p>
                                <div class="bg-white text-blue-900 p-3 rounded font-mono text-center font-bold text-lg mt-3 shadow-lg transform scale-105">
                                    100 ml 칭 10 kg = <span class="text-2xl">10</span> ml/kg
                                </div>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-center text-sm">
                                <div class="bg-blue-800/50 p-3 rounded">
                                    <i class="fa-solid fa-bottle-water text-2xl mb-1 block opacity-50"></i>
                                    1 Tapa Detergente<br><strong>~ 50 ml</strong>
                                </div>
                                <div class="bg-blue-800/50 p-3 rounded">
                                    <i class="fa-solid fa-mug-hot text-2xl mb-1 block opacity-50"></i>
                                    1 Taza Cocina<br><strong>~ 240 ml</strong>
                                </div>
                                <div class="bg-blue-800/50 p-3 rounded">
                                    <i class="fa-solid fa-cube text-2xl mb-1 block opacity-50"></i>
                                    Vaso Desechable<br><strong>~ 200 ml</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            }
        ];

        function loadChapter(index) {
            const contentDiv = document.getElementById('course-content');
            const data = courseData[index];
            const select = document.getElementById('chapterSelect');
            
            // Sincronizar select si se llama desde bot칩n externo
            select.value = index;

            // Renderizar contenido con animaci칩n
            contentDiv.innerHTML = `
                <div class="border-b border-slate-100 pb-4 mb-6">
                    <span class="text-xs font-bold text-blue-600 uppercase tracking-widest">M칩dulo ${index}</span>
                    <h2 class="text-3xl font-bold text-slate-800 mt-1">${data.title}</h2>
                </div>
                <div class="fade-in text-slate-700 leading-relaxed text-lg">
                    ${data.content}
                </div>
            `;
            
            // Scroll suave hacia arriba en m칩viles
            if(window.innerWidth < 768) {
                document.getElementById('learning').scrollIntoView({behavior: 'smooth'});
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            loadChapter(0);
            updateAllCalculations();
        });

    </script>
</body>
</html>